---
title: "Assignment 3"
author: "ALZ Alliance"
format:
    html:
        toc: true
editor: visual
execute: 
  warning: false
---

```{r}
#| echo: false

knitr::opts_chunk$set(
  eval = TRUE,
  message = TRUE,
  warning = TRUE,
  error = TRUE
)
```

```{r}
# Loading the required library
library(tidyverse)
library(janitor)
library(knitr)
library(kableExtra)
library(stringr)
```

## Data processing

```{r}
# loading the data 
startup_finance <- read_csv(here::here("data","Finance_and_Insurance.csv")) |> clean_names()
startup_food <- read_csv(here::here("data","Food_and_services.csv")) |> clean_names()
startup_health <- read_csv(here::here("data","Health_Care.csv")) |> clean_names()
startup_it <- read_csv(here::here("data","Information_Sector.csv")) |> clean_names()
startup_manufacture <- read_csv(here::here("data","Manufactures.csv")) |> clean_names()
startup_retail <- read_csv(here::here("data","Retail_Trade.csv")) |>  clean_names()
```

#### Combining dataset into one

```{r}
# combining the dataset into one

startup_combined <- bind_rows(
  startup_finance,
  startup_food,
  startup_health,
  startup_it,
  startup_manufacture,
  startup_retail
)
```

#### Data cleaning

-   Convert years of operation into `start_year` and `end_year`
-   Mutate a col for length of business
-   Convert `how_much_they_raised` into numeric

```{r}
# Convert years of operation into `start_year` and `end_year`

startup_combined <- startup_combined |>
  mutate(
    year_range = str_extract(years_of_operation, "\\d{4}[-–]\\d{4}"), #extracting year range
        start_year = as.numeric(str_extract(year_range, "^\\d{4}")), # extracting start year and end year
    end_year = as.numeric(str_extract(year_range, "\\d{4}$"))
  )
head(startup_combined)
```

```{r}
#  Mutate a col for length of business
startup_combined <- startup_combined |>
  mutate(business_operation_year = end_year - start_year)
head(startup_combined)
```

```{r}
# Dropping extra column in terms of year
startup_combined <- startup_combined |>
  select(-year_range, -years_of_operation)

head(startup_combined)
```

##### Remove duplicated rows

```{r find duplicated names and remove them}

# Find companies with multiple observations
duplicated_names <- startup_combined |> 
  count(name) |> 
  filter(n > 1) |> 
  pull(name)

# Take a look to pick out which rows to remove
startup_combined |> 
  mutate(id = row_number()) |> 
  filter(name %in% duplicated_names) |> 
  arrange(name)

# Handpicked the rows to remove
removed_rows <- c(264, 89, 175, 306, 66, 259)
startup_combined <- startup_combined |> 
  mutate(id = row_number()) |> 
  filter(!id %in% removed_rows)
```

#### Understanding Dataset

```{r}
# adding table for data description

variable_description <- tibble::tibble(
  Variable = c(
    "name", "sector", "years_of_operation", "what_they_did",
    "how_much_they_raised", "why_they_failed", "takeaway", "giants",
    "no_budget", "competition", "poor_market_fit", "acquisition_stagnation",
    "platform_dependency", "monetization_failure", "niche_limits", "execution_flaws",
    "trend_shifts", "toxicity_trust_issues", "regulatory_pressure", "overhype"
  ),
  Description = c(
    "Name of the startup",
    "Business sector or industry",
    "Number of years the startup operated",
    "Description of what the startup did",
    "Total funds raised before failure (if available)",
    "Primary reason for startup failure",
    "Key takeaway or lesson from the failure",
    "Whether the startup competed with major players",
    "Failed due to budget constraints",
    "Faced tough competition",
    "Did not fit well with market demand",
    "Growth plateaued or stagnated",
    "Depended heavily on external platforms",
    "Could not effectively monetize",
    "Had limited market potential",
    "Poor execution or management issues",
    "Impact of changing industry trends",
    "Trust or toxicity issues in the team",
    "Faced legal or regulatory hurdles",
    "Failure due to excessive hype or unrealistic expectations"
  )
)

# Display as a table
kbl(variable_description, caption = "Variable Descriptions for Startup Combined Dataset") |>
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = F)
```

## Executive Summary (Linh)

## Introduction (Linh)

## Methodology (Ayush)

## Results (Zul + Linh)

### Why startups fail (Linh)

### Temporal analysis of start-up failures (Zul)

The dataset of 403 failed startups in US reveals that most operated for a short duration, with an average lifespan of approximately 7.5 years. Startups were primarily active between 2009 and 2021, with a peak in activity around 2015, likely driven by economic recovery post-2008. Closures spiked around 2021, possibly due to the COVID-19 pandemic’s economic impact. This suggests external factors like market instability influenced failures. The plot below shows the number of active startups per year, highlighting periods of high activity and sharp declines, reflecting economic trends and challenges faced by startups.

```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(plotly)

# Assuming your dataset is named 'startup_combined'
# Create a data frame with one row per startup per active year
df_active_years <- startup_combined %>%
  mutate(year = map2(start_year, end_year, ~ seq(.x, .y))) %>%
  unnest(year) %>%
  select(year) %>%
  group_by(year) %>%
  summarise(count = n())

# Create a ggplot2 line plot
p <- ggplot(df_active_years, aes(x = year, y = count, text = paste("Year:", year, "<br>Active Startups:", count))) +
  geom_line(color = "#4e79a7", size = 1.2) +
  geom_point(color = "#4e79a7", size = 3) +
  labs(title = "Number of Active Startups per Year",
       x = "Year",
       y = "Number of Active Startups") +
  theme_minimal() +
  theme(axis.text = element_text(size = 10),
        plot.title = element_text(hjust = 0.5))

# Convert to interactive plot with ggplotly
ggplotly(p, tooltip = "text")
```
## Conclusion (Zul + Linh)

### Why startups fail (Linh)

### Temporal analysis of start-up failures (Zul)
